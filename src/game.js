export const excludedSquares = [
    [0, 0], [1, 0], [2, 0], [3, 0], [4, 0], [5, 0], [6, 0], [7, 0], [8, 0],
    [0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1],
    [0, 2], [1, 2], [2, 2], [3, 2], [4, 2], [5, 2], [6, 2],
    [0, 3], [1, 3], [2, 3], [3, 3], [4, 3], [5, 3],
    [0, 4], [1, 4], [2, 4], [3, 4], [4, 4], [5, 4],
    [0, 5], [1, 5], [2, 5], [3, 5], [4, 5], [5, 5],
    [0, 6], [1, 6], [2, 6], [3, 6], [4, 6],
    [0, 7], [1, 7], [2, 7],

    [19, 0], [20, 0], [21, 0], [22, 0], [23, 0], [24, 0], [25, 0], [26, 0], [27, 0], [28, 0], [29, 0], [30, 0], [31, 0], [32, 0], [33, 0], [34, 0],
    [20, 1], [21, 1], [22, 1], [23, 1], [24, 1], [25, 1], [26, 1], [27, 1], [28, 1], [29, 1], [30, 1], [31, 1],
    [21, 2], [22, 2], [23, 2], [24, 2], [25, 2], [26, 2], [27, 2], [28, 2], [29, 2], [30, 2], [31, 2],
    [21, 3], [22, 3], [23, 3], [24, 3], [25, 3], [26, 3], [27, 3], [28, 3], [29, 3], [30, 3],
    [22, 4], [23, 4], [24, 4], [25, 4], [26, 4], [27, 4], [28, 4], [29, 4], [30, 4],
    [23, 5], [24, 5], [25, 5], [26, 5], [27, 5], [28, 5], [29, 5],
    [25, 6], [26, 6], [27, 6], [28, 6],
    [26, 7], [27, 7], [28, 7],
    [27, 8], [28, 8],
    [27, 9], [28, 9],
    [27, 10],
    [27, 11],
    [26, 12], [27, 12],

    [15, 12], [16, 12], [17, 12], [18, 12],
    [15, 13], [16, 13], [17, 13], [18, 13], [19, 13], [20, 13],
    [14, 14], [15, 14], [16, 14], [17, 14], [18, 14], [19, 14], [20, 14], [21, 14],
    [14, 15], [15, 15], [16, 15], [17, 15], [18, 15], [19, 15], [20, 15], [21, 15], [22, 15], [23, 15],
    [14, 16], [15, 16], [16, 16], [17, 16], [18, 16], [19, 16], [20, 16], [21, 16], [22, 16],
    [14, 17], [15, 17], [16, 17], [17, 17], [18, 17], [19, 17], [20, 17], [21, 17], [22, 17],
    [14, 18], [15, 18], [16, 18], [17, 18], [18, 18], [19, 18], [20, 18], [21, 18],
    [15, 19], [16, 19], [17, 19], [18, 19], [19, 19], [20, 19],
    [17, 20], [18, 20], [19, 20],
    [18, 21],

    [3, 16],
    [3, 17],
    [3, 18], [4, 18],
    [3, 19], [4, 19],
    [3, 20], [4, 20],
    [3, 21],
    [3, 22],

    [41, 17], [42, 17],
    [40, 18], [41, 18], [42, 18],
    [39, 19], [40, 19], [41, 19], [42, 19],
    [36, 20], [37, 20], [38, 20], [39, 20], [40, 20], [41, 20], [42, 20],
    [30, 21], [31, 21], [32, 21], [33, 21], [34, 21], [35, 21], [36, 21], [37, 21], [38, 21], [39, 21], [40, 21], [41, 21], [42, 21],
    [28, 22], [29, 22], [30, 22], [31, 22], [32, 22], [33, 22], [34, 22], [35, 22], [36, 22], [37, 22], [38, 22], [39, 22], [40, 22], [41, 22], [42, 22],
    [27, 23], [28, 23], [29, 23], [30, 23], [31, 23], [32, 23], [33, 23], [34, 23], [35, 23], [36, 23], [37, 23], [38, 23], [39, 23], [40, 23], [41, 23], [42, 23],
    [26, 24], [27, 24], [29, 24], [30, 24], [31, 24], [32, 24], [33, 24], [34, 24], [35, 24], [36, 24], [38, 24], [39, 24], [40, 24], [41, 24], [42, 24],
    [40, 25], [41, 25], [42, 25],
    [41, 26], [42, 26],
    [41, 27], [42, 27],
    [40, 28], [41, 28], [42, 28],
    [40, 29], [41, 29], [42, 29],
    [36, 30], [37, 30], [38, 30], [39, 30], [40, 30], [41, 30], [42, 30],
    [31, 31], [32, 31], [33, 31], [34, 31], [35, 31], [36, 31], [37, 31], [38, 31], [39, 31], [40, 31], [41, 31], [42, 31],
];

export const startSquares = [
    { label: 1, location: [33, 25] },
    { label: 2, location: [33, 26] },
    { label: 3, location: [33, 27] },
    { label: 4, location: [33, 28] },
    { label: 5, location: [33, 29] },
    { label: 6, location: [33, 30] },
];

export const startFinishSquare = {
    location: /** @type {[number, number]} */([27,27])
};

export const markers = [
    { label: "A", location: [37,4] },
    { label: "B", location: [10,4] },
    { label: "C", location: [5,27] },
];

export function getPossibleMoves (boat, boats, windDirection) {
    const out = [];

    for (const dir of Object.values(COMPASS)) {
        let squares = getSailingSpeed(dir, windDirection);

        if (squares === 3 && boat.spinnakerUp) {
            squares = 5;
        }

        if (squares > 0) {
            const end = checkPath(boat.location, dir, squares, boats);
            if (end) {
                out.push(end);
            }
        }
    }

    return out;
}

function getSailingSpeed (heading, wind) {
    const delta = Math.abs(heading - wind);

    if (delta === 0) return 0;

    if (delta === 45 || delta === 315) return 1;

    if (delta === 90 || delta === 270) return 2;

    return 3;
}

function checkPath (startLocation, direction, distance, boats) {
    let dx = 0, dy = 0;

    if (direction === COMPASS.N) {
        dx = 0;
        dy = -1;
    }
    else if (direction === COMPASS.NE) {
        dx = 1;
        dy = -1;
    }
    else if (direction === COMPASS.E) {
        dx = 1;
        dy = 0;
    }
    else if (direction === COMPASS.SE) {
        dx = 1;
        dy = 1;
    }
    else if (direction === COMPASS.S) {
        dx = 0;
        dy = 1;
    }
    else if (direction === COMPASS.SW) {
        dx = -1;
        dy = 1;
    }
    else if (direction === COMPASS.W) {
        dx = -1;
        dy = 0;
    }
    else if (direction === COMPASS.NW) {
        dx = -1;
        dy = -1;
    }

    let location = [...startLocation];

    for (let i = 0; i < distance; i++) {
        location = [location[0] + dx, location[1] + dy];
        if (!checkSquare(location, boats)) return false;
    }

    return location;
}

function checkSquare (location, boats) {
    if (boats.some(b => !b.finished && b.location[0] === location[0] && b.location[1] === location[1])) return false;

    if (isLocationIncluded(excludedSquares, location)) return false;

    if (markers.some(m => m.location[0] === location[0] && m.location[1] === location[1])) return false;

    return true;
}

export function isLocationIncluded(array, loc) {
    return array.some(ex => ex[0] === loc[0] && ex[1] === loc[1]);
}


export const COMPASS = {
    N: 0,
    NE: 45,
    E: 90,
    SE: 135,
    S: 180,
    SW: 225,
    W: 270,
    NW: 315,
};